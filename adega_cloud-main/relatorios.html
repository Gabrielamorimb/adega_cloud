<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios - Estoque Fácil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Configuração do Tailwind para cores personalizadas */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --info-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        /* Animações suaves */
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }

        .animate-scale-in {
            animation: scaleIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Background com padrão sutil */
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
        }

        /* Sidebar moderna */
        .sidebar {
            background: linear-gradient(180deg, #1a202c 0%, #2d3748 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar.collapsed .hidden-text {
            display: none;
        }

        /* Cards com glassmorphism */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        /* Header moderno */
        .modern-header {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-bottom: 2px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        /* Filtros de período modernos */
        .period-filter {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .period-filter:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .period-filter.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        /* Inputs de data modernos */
        .modern-date-input {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .modern-date-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            outline: none;
            transform: translateY(-1px);
        }

        /* Cards de métricas */
        .metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .metric-card:hover::before {
            transform: scaleX(1);
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        /* Botões de exportação */
        .export-btn {
            background: var(--success-gradient);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .export-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .export-btn.secondary {
            background: var(--danger-gradient);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .export-btn.secondary:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        /* Tabela moderna */
        .modern-table {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
        }

        .modern-table thead {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .modern-table tbody tr {
            transition: all 0.2s ease;
            border-bottom: 1px solid #f1f5f9;
        }

        .modern-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transform: scale(1.01);
        }

        /* Badges para tipo de venda */
        .sale-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sale-type-unit {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .sale-type-package {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }

        /* Toast notification moderna */
        .toast-modern {
            background: var(--primary-gradient);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        .toast-error {
            background: var(--danger-gradient);
        }

        .toast-success {
            background: var(--success-gradient);
        }

        /* Loading spinner */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Melhorias para responsividade */
        @media (max-width: 768px) {
            .metric-card {
                padding: 1rem;
            }
            
            .period-filter {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .export-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Gráficos responsivos */
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
        }

        /* Seção de filtros */
        .filters-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* Estados vazios */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #d1d5db;
        }

        /* Debug panel */
        .debug-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
            display: none;
        }

        .debug-panel.show {
            display: block;
        }

        .debug-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar moderna -->
        <aside class="sidebar w-64 text-white flex-col flex-shrink-0 hidden md:flex animate-slide-up">
            <div class="flex items-center justify-center h-20 border-b border-gray-700 border-opacity-50">
                <a href="dashboard.html" class="flex items-center group">
                    <i class="fas fa-box text-blue-400 mr-3 text-2xl group-hover:scale-110 transition-transform duration-300"></i>
                    <span class="text-xl font-bold hidden-text bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Estoque Fácil</span>
                </a>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="dashboard.html" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gradient-to-r hover:from-gray-700 hover:to-gray-600 hover:text-white rounded-xl transition-all duration-300">
                    <i class="fas fa-home h-6 w-6 mr-3"></i>
                    <span class="hidden-text font-medium">Dashboard</span>
                </a>
                <a href="inventario.html" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gradient-to-r hover:from-gray-700 hover:to-gray-600 hover:text-white rounded-xl transition-all duration-300">
                    <i class="fas fa-archive h-6 w-6 mr-3"></i>
                    <span class="hidden-text font-medium">Inventário</span>
                </a>
                <a href="vendas.html" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gradient-to-r hover:from-gray-700 hover:to-gray-600 hover:text-white rounded-xl transition-all duration-300">
                    <i class="fas fa-shopping-cart h-6 w-6 mr-3"></i>
                    <span class="hidden-text font-medium">PDV - Vendas</span>
                </a>
                <a href="relatorios.html" class="flex items-center px-4 py-3 text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl transition-all duration-300 shadow-lg">
                    <i class="fas fa-chart-bar h-6 w-6 mr-3"></i>
                    <span class="hidden-text font-medium">Relatórios</span>
                </a>
                <a href="conta.html" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gradient-to-r hover:from-gray-700 hover:to-gray-600 hover:text-white rounded-xl transition-all duration-300">
                    <i class="fas fa-user-circle h-6 w-6 mr-3"></i>
                    <span class="hidden-text font-medium">Minha Conta</span>
                </a>
            </nav>
            <div class="px-4 py-4 border-t border-gray-700 border-opacity-50">
                <button id="logout-button" class="w-full flex items-center justify-center px-4 py-3 text-gray-300 hover:bg-gradient-to-r hover:from-red-600 hover:to-red-500 hover:text-white rounded-xl transition-all duration-300">
                    <i class="fas fa-sign-out-alt h-6 w-6 mr-3"></i>
                    <span class="hidden-text font-medium">Sair</span>
                </button>
            </div>
            <div class="p-2 text-center">
                <button id="toggle-sidebar" class="text-gray-400 hover:text-white transition-colors duration-300">
                    <i class="fas fa-chevron-left text-lg"></i>
                </button>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header moderno -->
            <header class="modern-header p-6 flex justify-between items-center animate-fade-in">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent flex items-center">
                        <i class="fas fa-chart-line mr-3 text-blue-600"></i>
                        Relatórios Detalhados
                    </h1>
                    <p class="text-gray-600 mt-1">Análise completa de vendas e performance</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="export-csv-btn" class="export-btn">
                        <i class="fas fa-file-csv"></i>
                        Exportar CSV
                    </button>
                    <button id="export-pdf-btn" class="export-btn secondary">
                        <i class="fas fa-file-pdf"></i>
                        Exportar PDF
                    </button>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-6">
                <!-- Seção de Filtros -->
                <div class="filters-section mb-8 animate-scale-in">
                    <h3 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent mb-4 flex items-center">
                        <i class="fas fa-filter mr-2 text-blue-600"></i>
                        Filtros de Período
                    </h3>
                    
                    <!-- Filtros Pré-definidos -->
                    <div class="mb-6">
                        <p class="text-sm font-semibold text-gray-700 mb-3">Períodos Pré-definidos:</p>
                        <div class="flex flex-wrap gap-3">
                            <button class="period-filter active" data-period="today">Hoje</button>
                            <button class="period-filter" data-period="yesterday">Ontem</button>
                            <button class="period-filter" data-period="last7days">Últimos 7 dias</button>
                            <button class="period-filter" data-period="last30days">Últimos 30 dias</button>
                            <button class="period-filter" data-period="this_month">Este mês</button>
                            <button class="period-filter" data-period="last_month">Mês passado</button>
                            <button class="period-filter" data-period="this_year">Este ano</button>
                            <button class="period-filter" data-period="last_year">Ano passado</button>
                        </div>
                    </div>

                    <!-- Período Personalizado -->
                    <div>
                        <p class="text-sm font-semibold text-gray-700 mb-3">Período Personalizado:</p>
                        <div class="flex flex-wrap gap-4 items-center">
                            <div class="flex items-center space-x-2">
                                <label for="start-date" class="text-sm font-medium text-gray-600">De:</label>
                                <input type="date" id="start-date" class="modern-date-input">
                            </div>
                            <div class="flex items-center space-x-2">
                                <label for="end-date" class="text-sm font-medium text-gray-600">Até:</label>
                                <input type="date" id="end-date" class="modern-date-input">
                            </div>
                            <button id="apply-custom-period" class="period-filter">
                                <i class="fas fa-search mr-2"></i>
                                Aplicar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loading-state" class="hidden text-center py-12">
                    <div class="loading-spinner"></div>
                    <p class="text-gray-600 mt-4">Carregando relatórios...</p>
                </div>

                <!-- Métricas Principais -->
                <div id="metrics-section" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8 animate-slide-up">
                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Faturamento Bruto</h4>
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-2 rounded-lg">
                                <i class="fas fa-dollar-sign text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="gross-revenue" class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent">R$ 0,00</p>
                        <div class="mt-2 flex items-center text-sm text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i>
                            <span>Antes do desconto</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Desconto Total</h4>
                            <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg">
                                <i class="fas fa-percent text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="total-discount" class="text-3xl font-bold bg-gradient-to-r from-orange-600 to-orange-800 bg-clip-text text-transparent">R$ 0,00</p>
                        <div class="mt-2 flex items-center text-sm text-gray-500">
                            <i class="fas fa-tag mr-1"></i>
                            <span>Descontos aplicados</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Faturamento Líquido</h4>
                            <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 p-2 rounded-lg">
                                <i class="fas fa-calculator text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="net-revenue" class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-indigo-800 bg-clip-text text-transparent">R$ 0,00</p>
                        <div class="mt-2 flex items-center text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            <span id="revenue-period">Período selecionado</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Lucro Real</h4>
                            <div class="bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg">
                                <i class="fas fa-chart-line text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="real-profit" class="text-3xl font-bold bg-gradient-to-r from-green-600 to-green-800 bg-clip-text text-transparent">R$ 0,00</p>
                        <div class="mt-2 flex items-center text-sm text-green-600">
                            <i class="fas fa-arrow-up mr-1"></i>
                            <span id="profit-margin">0% margem</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Total de Vendas</h4>
                            <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-2 rounded-lg">
                                <i class="fas fa-shopping-cart text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="total-sales" class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-purple-800 bg-clip-text text-transparent">0</p>
                        <div class="mt-2 flex items-center text-sm text-gray-500">
                            <i class="fas fa-receipt mr-1"></i>
                            <span>Transações</span>
                        </div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8 animate-fade-in">
                    <div class="chart-container">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">Evolução de Vendas</h3>
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-2 rounded-lg">
                                <i class="fas fa-chart-area text-white"></i>
                            </div>
                        </div>
                        <div id="sales-trend-chart"></div>
                    </div>

                    <div class="chart-container">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold bg-gradient-to-r from-green-500 to-blue-600 bg-clip-text text-transparent">Vendas por Categoria</h3>
                            <div class="bg-gradient-to-r from-green-500 to-blue-600 p-2 rounded-lg">
                                <i class="fas fa-chart-pie text-white"></i>
                            </div>
                        </div>
                        <div id="category-chart"></div>
                    </div>
                </div>

                <!-- Tabela de Produtos Mais Vendidos -->
                <div class="glass-card p-6 animate-slide-up mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">Produtos Mais Vendidos</h3>
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-2 rounded-lg">
                            <i class="fas fa-trophy text-white"></i>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="modern-table min-w-full">
                            <thead>
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Posição</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Produto</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Quantidade</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Faturamento</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Lucro</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Participação</th>
                                </tr>
                            </thead>
                            <tbody id="top-products-table">
                                <!-- Produtos serão inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabela de Histórico de Vendas -->
                <div class="glass-card p-6 animate-slide-up mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">Histórico de Vendas</h3>
                        <div class="bg-gradient-to-r from-purple-500 to-indigo-600 p-2 rounded-lg">
                            <i class="fas fa-history text-white"></i>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="modern-table min-w-full">
                            <thead>
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Produto</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Tipo</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Quantidade</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Preço Unit.</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Desconto</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Faturamento</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Lucro</th>
                                </tr>
                            </thead>
                            <tbody id="sales-history-table">
                                <!-- Histórico de vendas será inserido aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabela de Vendas por Categoria -->
                <div class="glass-card p-6 animate-slide-up mt-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">Vendas por Categoria</h3>
                        <div class="bg-gradient-to-r from-green-500 to-blue-600 p-2 rounded-lg">
                            <i class="fas fa-chart-pie text-white"></i>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="modern-table min-w-full">
                            <thead>
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Faturamento</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Participação</th>
                                </tr>
                            </thead>
                            <tbody id="category-table">
                                <!-- Categorias serão inseridas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast notification moderna -->
    <div id="toast-notification" class="hidden fixed bottom-5 right-5 toast-modern text-white px-6 py-4 rounded-2xl shadow-2xl transform translate-y-20 opacity-0">
        <p id="toast-message" class="font-medium"></p>
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel">
        <h4>Debug Info</h4>
        <div id="debug-content"></div>
    </div>
    
    <button id="debug-toggle" class="debug-toggle">
        <i class="fas fa-bug"></i>
    </button>

    <script>
        const SUPABASE_URL = 'https://urffzwmchbbeddpanopp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVyZmZ6d21jaGJiZWRkcGFub3BwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2NzE2MjcsImV4cCI6MjA2ODI0NzYyN30.OtBoVWqlFdoBeQx2-gYwzVPV2tALQ2xM6AK45kcpdQc';
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let currentUser = null;
        let currentPeriod = 'today';
        let currentStartDate = null;
        let currentEndDate = null;

        // Elementos DOM
        const loadingState = document.getElementById('loading-state');
        const metricsSection = document.getElementById('metrics-section');
        const toast = document.getElementById('toast-notification');
        const toastMessage = document.getElementById('toast-message');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar');
        const sidebar = document.querySelector('.sidebar');
        const debugPanel = document.getElementById('debug-panel');
        const debugContent = document.getElementById('debug-content');
        const debugToggle = document.getElementById('debug-toggle');

        // Inicialização dos gráficos
        let salesTrendChart = null;
        let categoryChart = null;

        // Debug functions
        function updateDebugInfo(data) {
            if (!data) return;
            
            const debugInfo = `
                <strong>Período:</strong> ${document.getElementById('revenue-period').textContent}<br>
                <strong>Total Vendas:</strong> ${data.totalSales}<br>
                <strong>Faturamento Bruto:</strong> R$ ${data.grossRevenue.toFixed(2)}<br>
                <strong>Desconto Total:</strong> R$ ${data.totalDiscount.toFixed(2)}<br>
                <strong>Faturamento Líquido:</strong> R$ ${data.netRevenue.toFixed(2)}<br>
                <strong>Lucro Real:</strong> R$ ${data.realProfit.toFixed(2)}<br>
                <strong>Margem:</strong> ${data.profitMargin.toFixed(2)}%<br>
                <strong>Produtos:</strong> ${data.topProducts.length}<br>
                <strong>Categorias:</strong> ${data.categoryData.length}<br>
                <strong>Soma Faturamento Produtos:</strong> R$ ${data.topProducts.reduce((sum, p) => sum + p.faturamento, 0).toFixed(2)}<br>
                <strong>Soma Lucro Produtos:</strong> R$ ${data.topProducts.reduce((sum, p) => sum + p.lucro, 0).toFixed(2)}<br>
                <strong>Soma Participação:</strong> ${data.categoryData.reduce((sum, c) => sum + ((c.value / data.grossRevenue) * 100), 0).toFixed(2)}%
            `;
            debugContent.innerHTML = debugInfo;
        }

        debugToggle.addEventListener('click', () => {
            debugPanel.classList.toggle('show');
        });

        // Funções de utilidade
        function showToast(message, type = 'info') {
            toastMessage.textContent = message;
            toast.classList.remove('hidden', 'translate-y-20', 'opacity-0', 'toast-modern', 'toast-error', 'toast-success');
            
            if (type === 'error') {
                toast.classList.add('toast-error');
            } else if (type === 'success') {
                toast.classList.add('toast-success');
            } else {
                toast.classList.add('toast-modern');
            }
            
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }

        function showLoading() {
            loadingState.classList.remove('hidden');
            metricsSection.style.opacity = '0.5';
        }

        function hideLoading() {
            loadingState.classList.add('hidden');
            metricsSection.style.opacity = '1';
        }

        function formatCurrency(value) {
            return `R$ ${value.toFixed(2).replace('.', ',')}`;
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('pt-BR');
        }

        // Função para determinar o tipo de venda baseado no preço e produto
        function determineSaleType(item, product) {
            // Se o produto tem dados de pacote configurados
            if (product.codigo_sku_pacote && product.preco_venda_pacote && product.fator_conversao > 1) {
                // Se o preço unitário na venda é igual ao preço do pacote, é uma venda de fardo
                if (Math.abs(item.preco_unitario_na_venda - product.preco_venda_pacote) < 0.01) {
                    return 'fardo';
                }
            }
            
            // Caso contrário, é uma venda de unidade
            return 'unidade';
        }

        // Funções de período
        function getPeriodDates(period) {
            const now = new Date();
            let startDate = new Date();
            let endDate = new Date();

            switch (period) {
                case 'today':
                    startDate.setHours(0, 0, 0, 0);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'yesterday':
                    startDate.setDate(now.getDate() - 1);
                    startDate.setHours(0, 0, 0, 0);
                    endDate.setDate(now.getDate() - 1);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'last7days':
                    startDate.setDate(now.getDate() - 6);
                    startDate.setHours(0, 0, 0, 0);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'last30days':
                    startDate.setDate(now.getDate() - 29);
                    startDate.setHours(0, 0, 0, 0);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'this_month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59, 999);
                    break;
                case 'last_month':
                    startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), 0, 23, 59, 59, 999);
                    break;
                case 'this_year':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    endDate = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999);
                    break;
                case 'last_year':
                    startDate = new Date(now.getFullYear() - 1, 0, 1);
                    endDate = new Date(now.getFullYear() - 1, 11, 31, 23, 59, 59, 999);
                    break;
                default:
                    startDate.setHours(0, 0, 0, 0);
                    endDate.setHours(23, 59, 59, 999);
            }

            return { startDate, endDate };
        }

        // FUNÇÃO PRINCIPAL CORRIGIDA PARA BUSCAR DADOS DO RELATÓRIO COM CÁLCULO CORRETO DO LUCRO
        async function fetchReportData(startDate, endDate) {
            try {
                console.log('🔍 Buscando dados do relatório...', { startDate: startDate.toISOString(), endDate: endDate.toISOString() });
                
                // Buscar vendas no período com dados completos do produto E dados de desconto
                const { data: sales, error: salesError } = await supabaseClient
                    .from('vendas')
                    .select(`
                        id,
                        valor_total,
                        desconto_aplicado,
                        tipo_desconto,
                        valor_desconto,
                        created_at,
                        itens_venda(
                            quantidade,
                            preco_unitario_na_venda,
                            custo_unitario_na_venda,
                            produtos(
                                id,
                                nome,
                                categoria,
                                preco_custo,
                                preco_venda,
                                codigo_sku_pacote,
                                preco_venda_pacote,
                                fator_conversao,
                                deleted
                            )
                        )
                    `)
                    .gte('created_at', startDate.toISOString())
                    .lte('created_at', endDate.toISOString())
                    .order('created_at', { ascending: true });

                if (salesError) throw salesError;

                console.log('📊 Dados brutos recebidos:', { totalSales: sales?.length || 0, sales });

                // Processar dados com validações aprimoradas E CÁLCULO CORRETO DO LUCRO
                let netRevenue = 0; // Faturamento líquido (após desconto)
                let totalDiscount = 0; // Total de descontos aplicados
                let totalCost = 0;
                let totalSales = sales?.length || 0;
                const productSales = {};
                const categorySales = {};
                const dailySales = {};
                const allSalesItems = []; // Nova array para armazenar todos os itens de venda

                // Validação inicial
                if (!sales || !Array.isArray(sales)) {
                    console.warn('⚠️ Nenhuma venda encontrada ou dados inválidos');
                    return {
                        grossRevenue: 0,
                        netRevenue: 0,
                        totalDiscount: 0,
                        realProfit: 0,
                        totalSales: 0,
                        topProducts: [],
                        salesTrend: [],
                        categoryData: [],
                        profitMargin: 0
                    };
                }

                // Processar cada venda
                sales.forEach((sale, saleIndex) => {
                    // Validação da venda
                    if (!sale || typeof sale.valor_total !== 'number') {
                        console.warn(`⚠️ Venda ${saleIndex} inválida:`, sale);
                        return;
                    }

                    // SOMAR FATURAMENTO LÍQUIDO (valor_total já é após desconto)
                    netRevenue += sale.valor_total;
                    
                    // SOMAR DESCONTO APLICADO (se houver)
                    const saleDiscount = Number(sale.desconto_aplicado) || 0;
                    totalDiscount += saleDiscount;

                    // Calcular faturamento bruto da venda para distribuição proporcional do desconto
                    const saleGrossTotal = sale.itens_venda.reduce((sum, saleItem) => {
                        return sum + (Number(saleItem.quantidade) * Number(saleItem.preco_unitario_na_venda));
                    }, 0);

                    // Processar data para gráfico de tendência (usar faturamento líquido)
                    const saleDate = new Date(sale.created_at).toLocaleDateString('pt-BR');
                    if (!dailySales[saleDate]) {
                        dailySales[saleDate] = 0;
                    }
                    dailySales[saleDate] += sale.valor_total;

                    // Processar itens da venda
                    if (sale.itens_venda && Array.isArray(sale.itens_venda)) {
                        sale.itens_venda.forEach((item, itemIndex) => {
                            // Validação do item
                            if (!item || !item.produtos) {
                                console.warn(`⚠️ Item ${itemIndex} da venda ${sale.id} sem produto associado:`, item);
                                return;
                            }

                            const product = item.produtos;
                            
                            // Validação do produto
                            if (!product.id) {
                                console.warn(`⚠️ Produto sem ID válido na venda ${sale.id}:`, product);
                                return;
                            }

                            // Validação dos valores numéricos
                            const quantidade = Number(item.quantidade) || 0;
                            const precoUnitario = Number(item.preco_unitario_na_venda) || 0;
                            const custoUnitario = Number(item.custo_unitario_na_venda) || Number(product.preco_custo) || 0;

                            if (quantidade <= 0) {
                                console.warn(`⚠️ Quantidade inválida no item ${itemIndex} da venda ${sale.id}:`, quantidade);
                                return;
                            }

                            const itemCost = custoUnitario * quantidade;
                            const itemRevenueBruto = precoUnitario * quantidade; // Faturamento bruto do item
                            
                            // CALCULAR DESCONTO PROPORCIONAL DO ITEM
                            // Se a venda teve desconto, aplicar proporcionalmente a cada item
                            let itemDiscount = 0;
                            let itemRevenueLiquido = itemRevenueBruto;
                            
                            if (saleDiscount > 0 && saleGrossTotal > 0) {
                                // Calcular desconto proporcional deste item
                                itemDiscount = (itemRevenueBruto / saleGrossTotal) * saleDiscount;
                                itemRevenueLiquido = itemRevenueBruto - itemDiscount;
                            }
                            
                            totalCost += itemCost;

                            // Determinar tipo de venda (unidade ou fardo)
                            const saleType = determineSaleType(item, product);

                            // DADOS POR PRODUTO - AGORA USANDO FATURAMENTO LÍQUIDO E LUCRO REAL
                            if (!productSales[product.id]) {
                                productSales[product.id] = {
                                    id: product.id,
                                    nome: product.nome || 'Produto sem nome',
                                    categoria: product.categoria || 'Sem Categoria',
                                    quantidade: 0,
                                    faturamento: 0, // Agora será faturamento líquido
                                    custo: 0,
                                    lucro: 0 // Agora será lucro real (após desconto)
                                };
                            }
                            
                            productSales[product.id].quantidade += quantidade;
                            productSales[product.id].faturamento += itemRevenueLiquido; // USAR FATURAMENTO LÍQUIDO
                            productSales[product.id].custo += itemCost;
                            productSales[product.id].lucro = productSales[product.id].faturamento - productSales[product.id].custo; // LUCRO REAL

                            // Dados por categoria - USAR FATURAMENTO LÍQUIDO
                            const category = product.categoria || 'Sem Categoria';
                            if (!categorySales[category]) {
                                categorySales[category] = 0;
                            }
                            categorySales[category] += itemRevenueLiquido; // USAR FATURAMENTO LÍQUIDO

                            // Adicionar item à lista de todos os itens de venda COM DADOS DE DESCONTO
                            allSalesItems.push({
                                saleId: sale.id,
                                saleDate: new Date(sale.created_at),
                                productName: product.nome + (product.deleted ? ' (Excluído)' : '') || 'Produto sem nome',
                                category: product.categoria || 'Sem Categoria',
                                saleType: saleType,
                                quantity: quantidade,
                                unitPrice: precoUnitario,
                                itemRevenueBruto: itemRevenueBruto,
                                itemDiscount: itemDiscount,
                                itemRevenueLiquido: itemRevenueLiquido,
                                itemCost: itemCost,
                                itemProfit: itemRevenueLiquido - itemCost // LUCRO REAL (após desconto)
                            });
                        });
                    }
                });

                // CALCULAR MÉTRICAS FINAIS CORRIGIDAS
                const grossRevenue = netRevenue + totalDiscount; // Faturamento bruto = líquido + desconto
                const realProfit = netRevenue - totalCost; // Lucro real = faturamento líquido - custo

                // Preparar dados dos produtos mais vendidos
                const topProducts = Object.values(productSales)
                    .sort((a, b) => b.quantidade - a.quantidade)
                    .slice(0, 10);

                // Preparar dados de tendência de vendas (usar faturamento líquido)
                const salesTrend = Object.entries(dailySales)
                    .map(([date, value]) => ({ date, value }))
                    .sort((a, b) => new Date(a.date.split('/').reverse().join('-')) - new Date(b.date.split('/').reverse().join('-')));

                // Preparar dados de categoria (usar faturamento líquido)
                const categoryData = Object.entries(categorySales)
                    .map(([category, value]) => ({ category, value }))
                    .sort((a, b) => b.value - a.value)
                    .slice(0, 6);

                // Validações finais
                const totalProductRevenue = topProducts.reduce((sum, p) => sum + p.faturamento, 0);
                const totalCategoryRevenue = categoryData.reduce((sum, c) => sum + c.value, 0);
                
                console.log('✅ Validações finais CORRIGIDAS:', {
                    grossRevenue,
                    netRevenue,
                    totalDiscount,
                    totalProductRevenue,
                    totalCategoryRevenue,
                    realProfit,
                    totalCost,
                    profitMargin: netRevenue > 0 ? (realProfit / netRevenue) * 100 : 0
                });

                const result = {
                    grossRevenue,
                    netRevenue,
                    totalDiscount,
                    realProfit,
                    totalSales,
                    topProducts,
                    salesTrend,
                    categoryData,
                    profitMargin: netRevenue > 0 ? (realProfit / netRevenue) * 100 : 0,
                    allSalesItems
                };

                console.log('📈 Dados processados CORRIGIDOS:', result);
                return result;

            } catch (error) {
                console.error('❌ Erro ao buscar dados do relatório:', error);
                throw error;
            }
        }

        function updateMetrics(data) {
            // Atualizar métricas principais CORRIGIDAS
            document.getElementById('gross-revenue').textContent = formatCurrency(data.grossRevenue);
            document.getElementById('total-discount').textContent = formatCurrency(data.totalDiscount);
            document.getElementById('net-revenue').textContent = formatCurrency(data.netRevenue);
            document.getElementById('real-profit').textContent = formatCurrency(data.realProfit);
            document.getElementById('total-sales').textContent = data.totalSales.toString();
            
            // Atualizar margem de lucro
            const profitMarginElement = document.getElementById('profit-margin');
            profitMarginElement.textContent = `${data.profitMargin.toFixed(1).replace('.', ',')}% margem`;
            
            // Adicionar classe de cor baseada na margem
            profitMarginElement.className = 'mt-2 flex items-center text-sm';
            if (data.profitMargin > 0) {
                profitMarginElement.classList.add('text-green-600');
                profitMarginElement.innerHTML = `<i class="fas fa-arrow-up mr-1"></i>${data.profitMargin.toFixed(1).replace('.', ',')}% margem`;
            } else if (data.profitMargin < 0) {
                profitMarginElement.classList.add('text-red-600');
                profitMarginElement.innerHTML = `<i class="fas fa-arrow-down mr-1"></i>${Math.abs(data.profitMargin).toFixed(1).replace('.', ',')}% prejuízo`;
            } else {
                profitMarginElement.classList.add('text-gray-500');
                profitMarginElement.innerHTML = `<i class="fas fa-minus mr-1"></i>0% margem`;
            }
        }

        function updateCharts(data) {
            // Atualizar gráfico de tendência de vendas
            if (salesTrendChart && data.salesTrend.length > 0) {
                const categories = data.salesTrend.map(item => item.date);
                const values = data.salesTrend.map(item => item.value);
                
                salesTrendChart.updateOptions({
                    series: [{ name: 'Faturamento', data: values }],
                    xaxis: { categories: categories }
                });
            } else if (salesTrendChart) {
                salesTrendChart.updateOptions({
                    series: [{ name: 'Faturamento', data: [0] }],
                    xaxis: { categories: ['Sem dados'] }
                });
            }

            // Atualizar gráfico de categorias
            if (categoryChart && data.categoryData.length > 0) {
                const categories = data.categoryData.map(item => item.category);
                const values = data.categoryData.map(item => item.value);
                
                categoryChart.updateOptions({
                    series: values,
                    labels: categories
                });
            } else if (categoryChart) {
                categoryChart.updateOptions({
                    series: [1],
                    labels: ['Nenhuma venda no período']
                });
            }
        }

        // FUNÇÃO ATUALIZADA COM DADOS DE DESCONTO E LUCRO CORRETO
        function updateSalesHistoryTable(salesItems) {
            const tableBody = document.getElementById('sales-history-table');
            tableBody.innerHTML = '';

            if (salesItems.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>Nenhuma venda encontrada no período selecionado</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // Ordenar por data (mais recente primeiro)
            const sortedItems = salesItems.sort((a, b) => b.saleDate - a.saleDate);

            sortedItems.forEach((item) => {
                const formattedDate = item.saleDate.toLocaleDateString('pt-BR');
                const formattedTime = item.saleDate.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                // Determinar badge do tipo de venda
                const saleTypeBadge = item.saleType === 'fardo' 
                    ? '<span class="sale-type-badge sale-type-package"><i class="fas fa-boxes"></i> Fardo</span>'
                    : '<span class="sale-type-badge sale-type-unit"><i class="fas fa-box"></i> Unidade</span>';

                const row = `
                    <tr class="hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div>
                                <div class="text-sm font-semibold text-gray-900">${formattedDate}</div>
                                <div class="text-xs text-gray-500">${formattedTime}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-semibold text-gray-900">${item.productName}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium">
                                ${item.category}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${saleTypeBadge}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium">
                                ${item.quantity}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                            ${formatCurrency(item.unitPrice)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${item.itemDiscount > 0 ? 'text-orange-600' : 'text-gray-400'}">
                            ${item.itemDiscount > 0 ? formatCurrency(item.itemDiscount) : 'R$ 0,00'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600">
                            ${formatCurrency(item.itemRevenueLiquido)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${item.itemProfit >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${formatCurrency(item.itemProfit)}
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // FUNÇÃO CORRIGIDA PARA PRODUTOS MAIS VENDIDOS - AGORA USA FATURAMENTO LÍQUIDO
        function updateTopProductsTable(products, netRevenue) {
            const tableBody = document.getElementById('top-products-table');
            tableBody.innerHTML = '';

            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-chart-bar"></i>
                            <p>Nenhum produto vendido no período selecionado</p>
                        </td>
                    </tr>
                `;
                return;
            }

            products.forEach((product, index) => {
                const position = index + 1;
                let positionIcon = '';
                let positionClass = '';

                // Ícones especiais para top 3
                if (position === 1) {
                    positionIcon = '<i class="fas fa-trophy text-yellow-500 mr-2"></i>';
                    positionClass = 'bg-gradient-to-r from-yellow-50 to-yellow-100';
                } else if (position === 2) {
                    positionIcon = '<i class="fas fa-medal text-gray-400 mr-2"></i>';
                    positionClass = 'bg-gradient-to-r from-gray-50 to-gray-100';
                } else if (position === 3) {
                    positionIcon = '<i class="fas fa-award text-orange-500 mr-2"></i>';
                    positionClass = 'bg-gradient-to-r from-orange-50 to-orange-100';
                }

                // CALCULAR PARTICIPAÇÃO BASEADA NO FATURAMENTO LÍQUIDO
                const participation = netRevenue > 0 ? ((product.faturamento / netRevenue) * 100) : 0;

                const row = `
                    <tr class="hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200 ${positionClass}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">
                            ${positionIcon}${position}º
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div>
                                <div class="text-sm font-semibold text-gray-900">${product.nome + (product.deleted ? ' (Excluído)' : '')}</div>
                                <div class="text-xs text-gray-500">${product.categoria || 'Sem categoria'}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium">
                                ${product.categoria || 'Sem categoria'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium">
                                ${product.quantidade} unidades
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600">
                            ${formatCurrency(product.faturamento)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${product.lucro >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${formatCurrency(product.lucro)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600">
                            ${participation.toFixed(1).replace('.', ',')}%
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // FUNÇÃO CORRIGIDA PARA CATEGORIAS - AGORA USA FATURAMENTO LÍQUIDO
        function updateCategoryTable(categoryData, netRevenue) {
            const tableBody = document.getElementById('category-table');
            tableBody.innerHTML = '';

            if (categoryData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="empty-state">
                            <i class="fas fa-chart-pie"></i>
                            <p>Nenhuma categoria encontrada no período selecionado</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let totalParticipation = 0;

            categoryData.forEach((category) => {
                // CALCULAR PARTICIPAÇÃO BASEADA NO FATURAMENTO LÍQUIDO
                const participation = netRevenue > 0 ? ((category.value / netRevenue) * 100) : 0;
                totalParticipation += participation;

                const row = `
                    <tr class="hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-semibold text-gray-900">${category.category}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600">
                            ${formatCurrency(category.value)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600">
                            ${participation.toFixed(1).replace('.', ',')}%
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });

            // Adicionar linha de total
            const totalRow = `
                <tr class="bg-gradient-to-r from-gray-50 to-gray-100 font-bold">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">
                        TOTAL
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600">
                        ${formatCurrency(netRevenue)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-blue-600">
                        ${totalParticipation.toFixed(1).replace('.', ',')}%
                    </td>
                </tr>
            `;
            tableBody.innerHTML += totalRow;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', async () => {
            // Verificar autenticação
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (!session) {
                window.location.href = 'login.html';
                return;
            }
            currentUser = session.user;

            // Inicializar gráficos
            initializeCharts();

            // Carregar dados iniciais
            await loadReportData();
        });

        // Sidebar toggle
        toggleSidebarBtn.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            const icon = toggleSidebarBtn.querySelector('i');
            if (sidebar.classList.contains('collapsed')) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            } else {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        });

        // Logout
        document.getElementById('logout-button').addEventListener('click', async () => {
            await supabaseClient.auth.signOut();
            window.location.href = 'index.html';
        });

        // Filtros de período
        document.addEventListener('click', async (e) => {
            if (e.target.classList.contains('period-filter') && e.target.dataset.period) {
                // Remover classe active de todos os botões
                document.querySelectorAll('.period-filter').forEach(btn => btn.classList.remove('active'));
                // Adicionar classe active ao botão clicado
                e.target.classList.add('active');
                
                currentPeriod = e.target.dataset.period;
                await loadReportData();
            }
        });

        // Período personalizado
        document.getElementById('apply-custom-period').addEventListener('click', async () => {
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            
            if (!startDateInput.value || !endDateInput.value) {
                showToast('Por favor, selecione as datas de início e fim.', 'error');
                return;
            }
            
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            
            if (startDate > endDate) {
                showToast('A data de início deve ser anterior à data de fim.', 'error');
                return;
            }
            
            // Remover classe active de todos os botões de período
            document.querySelectorAll('.period-filter').forEach(btn => btn.classList.remove('active'));
            // Adicionar classe active ao botão de aplicar
            document.getElementById('apply-custom-period').classList.add('active');
            
            currentPeriod = 'custom';
            currentStartDate = startDate;
            currentEndDate = endDate;
            
            await loadReportData();
        });

        // Exportação (placeholder)
        document.getElementById('export-csv-btn').addEventListener('click', () => {
            exportToCSV();
        });

        document.getElementById('export-pdf-btn').addEventListener('click', () => {
            exportToPDF();
        });

        // Funções de exportação ATUALIZADAS COM DADOS CORRETOS
        function exportToCSV() {
            try {
                if (!window.currentReportData || !window.currentReportData.topProducts) {
                    showToast('Nenhum dado disponível para exportação.', 'error');
                    return;
                }

                const data = window.currentReportData;
                
                // Cabeçalho do CSV
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "RELATÓRIO DE VENDAS - ESTOQUE FÁCIL\n";
                csvContent += `Período: ${document.getElementById('revenue-period').textContent}\n`;
                csvContent += `Gerado em: ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}\n\n`;
                
                // Métricas principais CORRIGIDAS
                csvContent += "Métrica,Valor\n";
                csvContent += `Faturamento Bruto,${formatCurrency(data.grossRevenue)}\n`;
                csvContent += `Desconto Total,${formatCurrency(data.totalDiscount)}\n`;
                csvContent += `Faturamento Líquido,${formatCurrency(data.netRevenue)}\n`;
                csvContent += `Lucro Real,${formatCurrency(data.realProfit)}\n`;
                csvContent += `Total de Vendas,${data.totalSales}\n`;
                csvContent += `Margem de Lucro,${data.profitMargin.toFixed(2)}%\n\n`;
                
                // Produtos mais vendidos CORRIGIDOS
                csvContent += "PRODUTOS MAIS VENDIDOS\n";
                csvContent += "Posição,Produto,Categoria,Quantidade Vendida,Faturamento,Lucro,Participação\n";
                
                data.topProducts.forEach((product, index) => {
                    const participation = data.netRevenue > 0 ? ((product.faturamento / data.netRevenue) * 100) : 0;
                    csvContent += `${index + 1},"${product.nome}","${product.categoria || 'Sem categoria'}",${product.quantidade},${product.faturamento.toFixed(2)},${product.lucro.toFixed(2)},${participation.toFixed(2)}%\n`;
                });

                // Histórico de vendas COM DADOS DE DESCONTO
                if (data.allSalesItems && data.allSalesItems.length > 0) {
                    csvContent += "\nHISTÓRICO DE VENDAS\n";
                    csvContent += "Data,Produto,Categoria,Tipo,Quantidade,Preço Unitário,Desconto,Faturamento,Lucro\n";
                    data.allSalesItems.forEach(item => {
                        const formattedDate = item.saleDate.toLocaleDateString('pt-BR');
                        const saleTypeText = item.saleType === 'fardo' ? 'Fardo' : 'Unidade';
                        csvContent += `"${formattedDate}","${item.productName}","${item.category}","${saleTypeText}",${item.quantity},${item.unitPrice.toFixed(2)},${item.itemDiscount.toFixed(2)},${item.itemRevenueLiquido.toFixed(2)},${item.itemProfit.toFixed(2)}\n`;
                    });
                }

                // Vendas por categoria CORRIGIDAS
                if (data.categoryData && data.categoryData.length > 0) {
                    csvContent += "\nVENDAS POR CATEGORIA\n";
                    csvContent += "Categoria,Faturamento,Participação\n";
                    data.categoryData.forEach(category => {
                        const participation = data.netRevenue > 0 ? ((category.value / data.netRevenue) * 100) : 0;
                        csvContent += `"${category.category}",${category.value.toFixed(2)},${participation.toFixed(2)}%\n`;
                    });
                }

                // Tendência de vendas
                if (data.salesTrend && data.salesTrend.length > 0) {
                    csvContent += "\nTENDÊNCIA DE VENDAS\n";
                    csvContent += "Data,Faturamento\n";
                    data.salesTrend.forEach(trend => {
                        csvContent += `"${trend.date}",${trend.value.toFixed(2)}\n`;
                    });
                }

                // Criar e baixar arquivo
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `relatorio_vendas_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast('Relatório CSV exportado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao exportar CSV:', error);
                showToast('Erro ao exportar relatório CSV.', 'error');
            }
        }

        function exportToPDF() {
            try {
                if (!window.currentReportData) {
                    showToast('Nenhum dado disponível para exportação.', 'error');
                    return;
                }

                const data = window.currentReportData;
                const period = document.getElementById('revenue-period').textContent;
                
                // Criar conteúdo HTML para o PDF ATUALIZADO COM DADOS CORRETOS
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Relatório de Vendas</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                margin: 20px; 
                                color: #333;
                                line-height: 1.6;
                            }
                            .header { 
                                text-align: center; 
                                margin-bottom: 30px; 
                                border-bottom: 2px solid #667eea;
                                padding-bottom: 20px;
                            }
                            .header h1 { 
                                color: #667eea; 
                                margin: 0;
                                font-size: 28px;
                            }
                            .header p { 
                                margin: 5px 0; 
                                color: #666;
                            }
                            .metrics { 
                                display: grid; 
                                grid-template-columns: repeat(2, 1fr); 
                                gap: 20px; 
                                margin-bottom: 30px;
                            }
                            .metric-card { 
                                border: 1px solid #e2e8f0; 
                                padding: 20px; 
                                border-radius: 8px;
                                background: #f8fafc;
                            }
                            .metric-card h3 { 
                                margin: 0 0 10px 0; 
                                color: #667eea;
                                font-size: 14px;
                                text-transform: uppercase;
                                letter-spacing: 1px;
                            }
                            .metric-card .value { 
                                font-size: 24px; 
                                font-weight: bold; 
                                color: #1a202c;
                            }
                            .section { 
                                margin-bottom: 30px;
                            }
                            .section h2 { 
                                color: #667eea; 
                                border-bottom: 1px solid #e2e8f0;
                                padding-bottom: 10px;
                                margin-bottom: 20px;
                            }
                            table { 
                                width: 100%; 
                                border-collapse: collapse; 
                                margin-bottom: 20px;
                            }
                            th, td { 
                                border: 1px solid #e2e8f0; 
                                padding: 12px; 
                                text-align: left;
                            }
                            th { 
                                background-color: #f8fafc; 
                                font-weight: bold;
                                color: #667eea;
                            }
                            tr:nth-child(even) { 
                                background-color: #f8fafc;
                            }
                            .footer { 
                                text-align: center; 
                                margin-top: 40px; 
                                padding-top: 20px;
                                border-top: 1px solid #e2e8f0;
                                color: #666;
                                font-size: 12px;
                            }
                            .positive { color: #10b981; }
                            .negative { color: #ef4444; }
                            .sale-type-unit { 
                                background: #10b981; 
                                color: white; 
                                padding: 2px 8px; 
                                border-radius: 12px; 
                                font-size: 10px; 
                                font-weight: bold;
                            }
                            .sale-type-package { 
                                background: #8b5cf6; 
                                color: white; 
                                padding: 2px 8px; 
                                border-radius: 12px; 
                                font-size: 10px; 
                                font-weight: bold;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>📊 Relatório de Vendas</h1>
                            <p><strong>Estoque Fácil</strong></p>
                            <p>Período: ${period}</p>
                            <p>Gerado em: ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}</p>
                        </div>

                        <div class="metrics">
                            <div class="metric-card">
                                <h3>Faturamento Bruto</h3>
                                <div class="value">${formatCurrency(data.grossRevenue)}</div>
                            </div>
                            <div class="metric-card">
                                <h3>Desconto Total</h3>
                                <div class="value">${formatCurrency(data.totalDiscount)}</div>
                            </div>
                            <div class="metric-card">
                                <h3>Faturamento Líquido</h3>
                                <div class="value">${formatCurrency(data.netRevenue)}</div>
                            </div>
                            <div class="metric-card">
                                <h3>Lucro Real</h3>
                                <div class="value ${data.realProfit >= 0 ? 'positive' : 'negative'}">${formatCurrency(data.realProfit)}</div>
                            </div>
                            <div class="metric-card">
                                <h3>Total de Vendas</h3>
                                <div class="value">${data.totalSales}</div>
                            </div>
                            <div class="metric-card">
                                <h3>Margem de Lucro</h3>
                                <div class="value ${data.profitMargin >= 0 ? 'positive' : 'negative'}">${data.profitMargin.toFixed(2)}%</div>
                            </div>
                        </div>

                        <div class="section">
                            <h2>🏆 Produtos Mais Vendidos</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Posição</th>
                                        <th>Produto</th>
                                        <th>Categoria</th>
                                        <th>Quantidade</th>
                                        <th>Faturamento</th>
                                        <th>Lucro</th>
                                        <th>Participação</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.topProducts.map((product, index) => {
                                        const participation = data.netRevenue > 0 ? ((product.faturamento / data.netRevenue) * 100) : 0;
                                        return `
                                            <tr>
                                                <td>${index + 1}º</td>
                                                <td>${product.nome + (product.deleted ? ' (Excluído)' : '')}</td>
                                                <td>${product.categoria || 'Sem categoria'}</td>
                                                <td>${product.quantidade}</td>
                                                <td>${formatCurrency(product.faturamento)}</td>
                                                <td class="${product.lucro >= 0 ? 'positive' : 'negative'}">${formatCurrency(product.lucro)}</td>
                                                <td>${participation.toFixed(1)}%</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        ${data.allSalesItems && data.allSalesItems.length > 0 ? `
                        <div class="section">
                            <h2>📋 Histórico de Vendas</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Produto</th>
                                        <th>Categoria</th>
                                        <th>Tipo</th>
                                        <th>Quantidade</th>
                                        <th>Preço Unit.</th>
                                        <th>Desconto</th>
                                        <th>Faturamento</th>
                                        <th>Lucro</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.allSalesItems.slice(0, 50).map(item => {
                                        const formattedDate = item.saleDate.toLocaleDateString('pt-BR');
                                        const saleTypeBadge = item.saleType === 'fardo' 
                                            ? '<span class="sale-type-package">FARDO</span>'
                                            : '<span class="sale-type-unit">UNIDADE</span>';
                                        return `
                                            <tr>
                                                <td>${formattedDate}</td>
                                                <td>${item.productName}</td>
                                                <td>${item.category}</td>
                                                <td>${saleTypeBadge}</td>
                                                <td>${item.quantity}</td>
                                                <td>${formatCurrency(item.unitPrice)}</td>
                                                <td>${formatCurrency(item.itemDiscount)}</td>
                                                <td>${formatCurrency(item.itemRevenueLiquido)}</td>
                                                <td class="${item.itemProfit >= 0 ? 'positive' : 'negative'}">${formatCurrency(item.itemProfit)}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                    ${data.allSalesItems.length > 50 ? `
                                    <tr>
                                        <td colspan="9" style="text-align: center; font-style: italic; color: #666;">
                                            ... e mais ${data.allSalesItems.length - 50} itens (consulte o relatório completo no sistema)
                                        </td>
                                    </tr>
                                    ` : ''}
                                </tbody>
                            </table>
                        </div>
                        ` : ''}

                        ${data.categoryData && data.categoryData.length > 0 ? `
                        <div class="section">
                            <h2>📈 Vendas por Categoria</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Categoria</th>
                                        <th>Faturamento</th>
                                        <th>Participação</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.categoryData.map(category => {
                                        const percentage = ((category.value / data.netRevenue) * 100).toFixed(1);
                                        return `
                                            <tr>
                                                <td>${category.category}</td>
                                                <td>${formatCurrency(category.value)}</td>
                                                <td>${percentage}%</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : ''}

                        <div class="footer">
                            <p>Relatório gerado automaticamente pelo sistema Estoque Fácil</p>
                            <p>© ${new Date().getFullYear()} - Todos os direitos reservados</p>
                        </div>
                    </body>
                    </html>
                `;

                // Criar nova janela para impressão
                const printWindow = window.open('', '_blank');
                printWindow.document.write(htmlContent);
                printWindow.document.close();
                
                // Aguardar carregamento e imprimir
                printWindow.onload = function() {
                    setTimeout(() => {
                        printWindow.print();
                        printWindow.close();
                    }, 500);
                };
                
                showToast('Relatório PDF gerado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao exportar PDF:', error);
                showToast('Erro ao gerar relatório PDF.', 'error');
            }
        }

        // Funções principais
        async function loadReportData() {
            showLoading();
            
            try {
                let startDate, endDate;
                
                if (currentPeriod === 'custom') {
                    startDate = currentStartDate;
                    endDate = currentEndDate;
                } else {
                    const dates = getPeriodDates(currentPeriod);
                    startDate = dates.startDate;
                    endDate = dates.endDate;
                }
                
                const data = await fetchReportData(startDate, endDate);
                
                // Armazenar dados globalmente para exportação
                window.currentReportData = data;
                
                updateMetrics(data);
                updateCharts(data);
                updateSalesHistoryTable(data.allSalesItems);
                updateTopProductsTable(data.topProducts, data.netRevenue); // USAR FATURAMENTO LÍQUIDO
                updateCategoryTable(data.categoryData, data.netRevenue); // USAR FATURAMENTO LÍQUIDO
                updateDebugInfo(data);
                
                // Atualizar texto do período
                document.getElementById('revenue-period').textContent = 
                    `${formatDate(startDate)} - ${formatDate(endDate)}`;
                
                showToast('Relatório atualizado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao carregar dados do relatório:', error);
                showToast('Erro ao carregar dados do relatório.', 'error');
            } finally {
                hideLoading();
            }
        }

        function initializeCharts() {
            // Gráfico de tendência de vendas
            const salesTrendOptions = {
                chart: {
                    type: 'area',
                    height: 350,
                    toolbar: { show: false },
                    background: 'transparent'
                },
                series: [{
                    name: 'Faturamento',
                    data: [0]
                }],
                xaxis: {
                    categories: [''],
                    labels: {
                        style: { colors: '#6b7280', fontSize: '12px', fontWeight: 500 }
                    }
                },
                yaxis: {
                    labels: {
                        formatter: (value) => formatCurrency(value),
                        style: { colors: '#6b7280', fontSize: '12px', fontWeight: 500 }
                    }
                },
                colors: ['#667eea'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.1,
                        stops: [0, 90, 100]
                    }
                },
                stroke: { curve: 'smooth', width: 3 },
                dataLabels: { enabled: false },
                grid: { borderColor: '#e5e7eb', strokeDashArray: 4 },
                tooltip: { theme: 'dark' }
            };

            salesTrendChart = new ApexCharts(document.querySelector("#sales-trend-chart"), salesTrendOptions);
            salesTrendChart.render();

            // Gráfico de categorias
            const categoryOptions = {
                chart: {
                    type: 'donut',
                    height: 350,
                    background: 'transparent'
                },
                series: [1],
                labels: ['Carregando...'],
                legend: {
                    position: 'bottom',
                    horizontalAlign: 'center',
                    fontSize: '12px',
                    fontWeight: 500
                },
                plotOptions: {
                    pie: {
                        donut: {
                            size: '70%',
                            labels: {
                                show: true,
                                total: {
                                    show: true,
                                    label: 'Total',
                                    fontSize: '14px',
                                    fontWeight: 600,
                                    color: '#374151'
                                }
                            }
                        }
                    }
                },
                colors: ['#10b981', '#3b82f6', '#6366f1', '#8b5cf6', '#ec4899', '#f59e0b'],
                dataLabels: {
                    enabled: true,
                    style: { colors: ['#fff'], fontSize: '12px', fontWeight: 600 }
                },
                stroke: { width: 2, colors: ['#fff'] },
                tooltip: { theme: 'dark' }
            };

            categoryChart = new ApexCharts(document.querySelector("#category-chart"), categoryOptions);
            categoryChart.render();
        }
    </script>
</body>
</html>

